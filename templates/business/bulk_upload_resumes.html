{% extends 'base.html' %}
{% load static %}
{% load screening_extras %}

{% block title %}Upload Resumes - Resume Screening Tool{% endblock %}

{% block content %}
<div class="min-h-screen flex">
    <!-- Include the sidebar -->
    {% include 'business/sidebar.html' with active='bulk_screening' %}

    <div class="flex-1 bg-gray-900">
        <div class="container mx-auto px-4 py-8">
            <div class="glass-card p-6 mb-8 rounded-xl shadow-xl border border-gray-700/50 backdrop-blur-sm">
                <div class="flex items-center gap-4 mb-4">
                    <a href="{% url 'bulk_screening' %}" class="text-blue-400 hover:text-blue-300 transition duration-150">
                        <i class="fas fa-arrow-left text-lg"></i>
                    </a>
                    <h1 class="text-3xl font-bold gradient-light-alt">Upload Resumes for Screening</h1>
                </div>
                
                {% if messages %}
                <div class="mb-6 animate__animated animate__fadeIn">
                    {% for message in messages %}
                    <div class="p-4 mb-3 rounded-lg shadow-md {% if message.tags == 'success' %}bg-green-800/40 border border-green-600/50{% elif message.tags == 'error' %}bg-red-800/40 border border-red-600/50{% elif message.tags == 'warning' %}bg-yellow-800/40 border border-yellow-600/50{% else %}bg-blue-800/40 border border-blue-600/50{% endif %}">
                        <div class="flex items-center">
                            <div class="flex-shrink-0">
                                {% if message.tags == 'success' %}
                                <i class="fas fa-check-circle text-green-400"></i>
                                {% elif message.tags == 'error' %}
                                <i class="fas fa-exclamation-circle text-red-400"></i>
                                {% elif message.tags == 'warning' %}
                                <i class="fas fa-exclamation-triangle text-yellow-400"></i>
                                {% else %}
                                <i class="fas fa-info-circle text-blue-400"></i>
                                {% endif %}
                            </div>
                            <div class="ml-3">
                                <p class="text-sm font-medium text-gray-200">{{ message }}</p>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% endif %}
                
                <div class="mb-6">
                    <h2 class="text-xl font-semibold mb-3 text-white">Job Requirements</h2>
                    <div class="bg-gray-800/30 p-4 rounded-xl border border-gray-700/40 shadow-lg">
                        <div class="mb-3 flex gap-2">
                            <span class="text-gray-400 font-medium">Job Title:</span>
                            <span class="text-white font-medium">{{ bulk_screen.job_title }}</span>
                        </div>
                        <div class="mb-3">
                            <span class="text-gray-400 font-medium">Required Skills:</span>
                            <div class="flex flex-wrap gap-2 mt-2">
                                {% with skills=bulk_screen.required_skills|stringformat:"s" %}
                                {% for skill in skills|cut:" "|split:"," %}
                                <span class="px-3 py-1 bg-blue-900/30 text-blue-300 rounded-lg text-sm border border-blue-800/30">{{ skill }}</span>
                                {% endfor %}
                                {% endwith %}
                            </div>
                        </div>
                        <div>
                            <span class="text-gray-400 font-medium">Preferred Experience:</span>
                            <span class="text-white ml-2 font-medium">{{ bulk_screen.preferred_experience }} years</span>
                        </div>
                    </div>
                </div>
                
                <div class="mb-6">
                    <div class="bg-gray-800/30 p-4 rounded-xl border border-gray-700/40 shadow-lg">
                        <div class="flex items-center gap-4">
                            <div class="p-3 bg-blue-600/80 rounded-full shadow-lg">
                                <i class="fas fa-file-alt text-white"></i>
                            </div>
                            <div>
                                <h2 class="text-lg font-semibold text-white">Resume Screening Quota</h2>
                                <p class="text-sm text-gray-300">You have <span class="text-blue-400 font-semibold">{{ remaining_resumes }}</span> resumes left in your current plan</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="bg-gray-800/30 p-6 rounded-xl border border-gray-700/40 shadow-lg hover:border-blue-700/40 transition duration-300">
                    <h2 class="text-xl font-semibold mb-6 text-white">Upload Resumes</h2>
                    <form method="POST" enctype="multipart/form-data" class="space-y-6">
                        {% csrf_token %}
                        
                        <div class="flex items-center justify-center w-full">
                            <label for="resume-files" class="flex flex-col items-center justify-center w-full h-64 border-2 border-dashed rounded-xl cursor-pointer bg-gray-800/30 border-gray-600/50 hover:bg-gray-700/30 hover:border-blue-500/50 transition duration-300">
                                <div class="flex flex-col items-center justify-center pt-5 pb-6">
                                    <div class="mb-4 rounded-full p-4 bg-blue-600/20">
                                        <i class="fas fa-cloud-upload-alt text-5xl text-blue-400"></i>
                                    </div>
                                    <p class="mb-2 text-sm text-gray-300"><span class="font-semibold">Click to upload</span> or drag and drop</p>
                                    <p class="text-xs text-gray-400">PDF, DOCX, or TXT (MAX. 10MB each)</p>
                                    <p class="mt-2 text-xs text-blue-400 font-medium">You can select multiple files</p>
                                </div>
                                <input id="resume-files" name="resumes" type="file" class="hidden" multiple accept=".pdf,.docx,.doc,.txt" />
                            </label>
                        </div>
                        
                        <div id="file-list-container" class="hidden bg-gray-800/30 rounded-xl p-4 border border-gray-700/40 shadow-lg">
                            <h3 class="text-lg font-medium mb-3 text-white">Selected Files:</h3>
                            <ul id="file-list" class="bg-gray-800/50 rounded-lg p-3 space-y-2 max-h-40 overflow-y-auto"></ul>
                            <div class="mt-3 flex items-center gap-2">
                                <i class="fas fa-files-o text-blue-400"></i>
                                <p class="text-sm text-gray-300">Total: <span id="file-count" class="font-semibold text-blue-400">0</span> files</p>
                            </div>
                        </div>
                        
                        <div class="flex justify-end">
                            <button type="submit" class="btn-gradient px-6 py-3 text-base font-medium rounded-lg shadow-lg transition duration-300 flex items-center" id="submit-button" disabled>
                                <i class="fas fa-search mr-2"></i> Start Screening
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.btn-gradient {
    background: linear-gradient(to right, #3b82f6, #2563eb);
    color: white;
    border: none;
    transition: all 0.3s ease;
}
.btn-gradient:hover {
    background: linear-gradient(to right, #2563eb, #1d4ed8);
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
}
.btn-gradient:disabled {
    background: linear-gradient(to right, #6b7280, #9ca3af);
    cursor: not-allowed;
    transform: none;
    box-shadow: none;
}
</style>

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const input = document.getElementById('resume-files');
        const fileList = document.getElementById('file-list');
        const fileListContainer = document.getElementById('file-list-container');
        const fileCount = document.getElementById('file-count');
        const submitButton = document.getElementById('submit-button');
        
        input.addEventListener('change', function() {
            fileList.innerHTML = '';
            const files = this.files;
            
            if (files.length > 0) {
                fileListContainer.classList.remove('hidden');
                fileCount.textContent = files.length;
                submitButton.disabled = false;
                
                for (let i = 0; i < files.length; i++) {
                    const file = files[i];
                    const item = document.createElement('li');
                    item.className = 'text-gray-300 text-sm flex items-center p-2 hover:bg-gray-700/30 rounded-lg transition duration-150';
                    
                    // Determine icon based on file type
                    let icon = 'fa-file';
                    let iconColor = 'text-gray-400';
                    if (file.name.endsWith('.pdf')) {
                        icon = 'fa-file-pdf';
                        iconColor = 'text-red-400';
                    } else if (file.name.endsWith('.doc') || file.name.endsWith('.docx')) {
                        icon = 'fa-file-word';
                        iconColor = 'text-blue-400';
                    } else if (file.name.endsWith('.txt')) {
                        icon = 'fa-file-alt';
                        iconColor = 'text-yellow-400';
                    }
                    
                    item.innerHTML = `
                        <i class="fas ${icon} ${iconColor} mr-2"></i>
                        <span class="truncate flex-1">${file.name}</span>
                        <span class="ml-2 text-gray-400 text-xs">(${(file.size / 1024).toFixed(1)} KB)</span>
                    `;
                    fileList.appendChild(item);
                }
            } else {
                fileListContainer.classList.add('hidden');
                submitButton.disabled = true;
            }
        });
    });
</script>
{% endblock %}
{% endblock %} 